# Auggie Command: ç”Ÿæˆ CRUD ä»£ç 
# åŸºäº Collection è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„ CRUD ä»£ç ï¼ˆæ§åˆ¶å™¨ã€è·¯ç”±ã€æµ‹è¯•ï¼‰

name: generate-crud
version: 1.0.0
description: åŸºäºå·²å­˜åœ¨çš„ Collection è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„ CRUD ä»£ç ï¼ŒåŒ…æ‹¬æ§åˆ¶å™¨ã€è·¯ç”±ã€éªŒè¯å™¨å’Œæµ‹è¯•

# å‘½ä»¤åˆ«å
aliases:
  - gen-crud
  - crud

# å‘½ä»¤å‚æ•°
parameters:
  - name: collection_name
    type: string
    required: true
    description: Collection åç§°
    example: Product
  
  - name: api_version
    type: string
    required: false
    default: v1
    description: API ç‰ˆæœ¬
  
  - name: with_validation
    type: boolean
    required: false
    default: true
    description: æ˜¯å¦ç”ŸæˆéªŒè¯å™¨
  
  - name: with_tests
    type: boolean
    required: false
    default: true
    description: æ˜¯å¦ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
  
  - name: with_docs
    type: boolean
    required: false
    default: true
    description: æ˜¯å¦ç”Ÿæˆ API æ–‡æ¡£

# æ‰§è¡Œæ­¥éª¤
steps:
  - name: load_collection
    description: åŠ è½½ Collection å®šä¹‰
    actions:
      - ä»æ•°æ®åº“åŠ è½½ Collection å…ƒæ•°æ®
      - è·å–å­—æ®µå®šä¹‰
      - è·å–å…³ç³»å®šä¹‰
    on_error: æç¤º Collection ä¸å­˜åœ¨
  
  - name: generate_controller
    description: ç”Ÿæˆæ§åˆ¶å™¨
    actions:
      - åˆ›å»ºæ–‡ä»¶ï¼šapp/controller/lowcode/{CollectionName}Controller.php
      - å®ç° CRUD æ–¹æ³•ï¼šindex, show, store, update, destroy
      - æ·»åŠ åˆ†é¡µã€æ’åºã€è¿‡æ»¤æ”¯æŒ
      - æ·»åŠ å…³ç³»æ•°æ®åŠ è½½
    template: |
      <?php
      
      declare(strict_types=1);
      
      namespace app\controller\lowcode;
      
      use app\controller\ApiController;
      use app\Request;
      use think\Response;
      use Infrastructure\Lowcode\Collection\Service\CollectionDataManager;
      
      /**
       * {CollectionName} CRUD Controller | {CollectionName} CRUDæ§åˆ¶å™¨
       * 
       * Auto-generated by AlkaidSYS CRUD Generator
       * ç”± AlkaidSYS CRUD ç”Ÿæˆå™¨è‡ªåŠ¨ç”Ÿæˆ
       * 
       * @package app\controller\lowcode
       */
      class {CollectionName}Controller extends ApiController
      {
          protected CollectionDataManager $dataManager;
          protected string $collectionName = '{collection_name}';
          
          public function __construct()
          {
              parent::__construct();
              $this->dataManager = app(CollectionDataManager::class);
          }
          
          /**
           * List {collection_name} | åˆ—è¡¨æŸ¥è¯¢
           * 
           * @param Request $request
           * @return Response
           */
          public function index(Request $request): Response
          {
              $params = $request->only(['page', 'limit', 'sort', 'order', 'filter']);
              
              $data = $this->dataManager->list(
                  $this->collectionName,
                  $params,
                  $request->tenantId(),
                  $request->siteId()
              );
              
              return $this->success($data);
          }
          
          // ... å…¶ä»– CRUD æ–¹æ³•
      }
  
  - name: generate_routes
    description: ç”Ÿæˆè·¯ç”±
    actions:
      - åœ¨ route/lowcode.php ä¸­æ·»åŠ è·¯ç”±ç»„
      - é…ç½®ä¸­é—´ä»¶ï¼ˆauth, permissionï¼‰
      - æ”¯æŒ RESTful è·¯ç”±

  - name: generate_validator
    description: ç”ŸæˆéªŒè¯å™¨
    condition: with_validation == true
    actions:
      - åŸºäº Collection å­—æ®µç”ŸæˆéªŒè¯è§„åˆ™
      - åˆ›å»ºæ–‡ä»¶ï¼šapp/validate/lowcode/{CollectionName}Validate.php

  - name: generate_tests
    description: ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
    condition: with_tests == true
    actions:
      - åˆ›å»ºæ–‡ä»¶ï¼štests/Feature/Lowcode/{CollectionName}CrudTest.php
      - æµ‹è¯•æ‰€æœ‰ CRUD æ“ä½œ
      - æµ‹è¯•æ•°æ®éªŒè¯
      - æµ‹è¯•æƒé™æ§åˆ¶

  - name: generate_docs
    description: ç”Ÿæˆ API æ–‡æ¡£
    condition: with_docs == true
    actions:
      - ç”Ÿæˆ OpenAPI è§„èŒƒ
      - æ›´æ–° API æ–‡æ¡£

# è¾“å‡º
outputs:
  - controller: app/controller/lowcode/{CollectionName}Controller.php
  - routes: route/lowcode.php (å·²æ›´æ–°)
  - validator: app/validate/lowcode/{CollectionName}Validate.php (å¯é€‰)
  - tests: tests/Feature/Lowcode/{CollectionName}CrudTest.php (å¯é€‰)
  - docs: API æ–‡æ¡£å·²æ›´æ–° (å¯é€‰)

# ä½¿ç”¨ç¤ºä¾‹
examples:
  - description: ä¸º Product Collection ç”Ÿæˆ CRUD
    command: auggie --print "ä¸º Product Collection ç”Ÿæˆå®Œæ•´çš„ CRUD ä»£ç "

  - description: ç”Ÿæˆä½†ä¸åŒ…å«æµ‹è¯•
    command: auggie --print "ä¸º Order Collection ç”Ÿæˆ CRUDï¼Œwith_tests=false"

# æˆåŠŸæ¶ˆæ¯
success_message: |
  âœ… CRUD ä»£ç ç”ŸæˆæˆåŠŸï¼

  ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶ï¼š
  - æ§åˆ¶å™¨ï¼šapp/controller/lowcode/{CollectionName}Controller.php
  - è·¯ç”±ï¼šroute/lowcode.php (å·²æ›´æ–°)
  - éªŒè¯å™¨ï¼šapp/validate/lowcode/{CollectionName}Validate.php
  - æµ‹è¯•ï¼štests/Feature/Lowcode/{CollectionName}CrudTest.php

  ğŸš€ ä¸‹ä¸€æ­¥ï¼š
  1. æŸ¥çœ‹ç”Ÿæˆçš„ä»£ç 
  2. è¿è¡Œæµ‹è¯•ï¼šphp think test tests/Feature/Lowcode/{CollectionName}CrudTest.php
  3. è®¿é—® APIï¼šhttp://localhost:8000/{api_version}/lowcode/{collection_name}

  ğŸ“š API ç«¯ç‚¹ï¼š
  - GET    /{api_version}/lowcode/{collection_name}      - åˆ—è¡¨æŸ¥è¯¢
  - GET    /{api_version}/lowcode/{collection_name}/:id  - å•æ¡æŸ¥è¯¢
  - POST   /{api_version}/lowcode/{collection_name}      - åˆ›å»º
  - PUT    /{api_version}/lowcode/{collection_name}/:id  - æ›´æ–°
  - DELETE /{api_version}/lowcode/{collection_name}/:id  - åˆ é™¤

