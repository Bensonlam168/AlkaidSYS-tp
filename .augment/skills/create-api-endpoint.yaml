# Skill: 创建 API 端点
# 用于快速创建符合 RESTful 规范的 API 端点

name: create-api-endpoint
version: 1.0.0
description: 创建一个新的 RESTful API 端点，包括路由、控制器、验证器和测试

# 输入参数
parameters:
  - name: resource_name
    type: string
    required: true
    description: 资源名称（复数形式，如：products、orders）
    example: products
  
  - name: controller_name
    type: string
    required: true
    description: 控制器名称（如：ProductController）
    example: ProductController
  
  - name: api_version
    type: string
    required: false
    default: v1
    description: API 版本
    example: v1
  
  - name: operations
    type: array
    required: true
    description: 需要实现的操作
    example: [index, show, store, update, destroy]
  
  - name: middleware
    type: array
    required: false
    description: 需要应用的中间件
    example: [auth, permission:product:read]
  
  - name: with_validation
    type: boolean
    required: false
    default: true
    description: 是否生成验证器
  
  - name: with_tests
    type: boolean
    required: false
    default: true
    description: 是否生成测试用例

# 执行步骤
steps:
  - name: create_controller
    description: 创建 API 控制器
    actions:
      - 创建文件：app/controller/{ControllerName}.php
      - 继承 ApiController 基类
      - 实现指定的操作方法
      - 添加 PHPDoc 注释
    template: |
      <?php
      
      declare(strict_types=1);
      
      namespace app\controller;
      
      use app\Request;
      use think\Response;
      
      /**
       * {ResourceName} API Controller | {ResourceName} API控制器
       * 
       * @package app\controller
       */
      class {ControllerName} extends ApiController
      {
          /**
           * List {resource_name} | 列表查询
           * 
           * @param Request $request
           * @return Response
           */
          public function index(Request $request): Response
          {
              // TODO: 实现列表查询逻辑
              return $this->success([]);
          }
          
          /**
           * Get single {resource_name} | 单条查询
           * 
           * @param int $id
           * @return Response
           */
          public function show(int $id): Response
          {
              // TODO: 实现单条查询逻辑
              return $this->success([]);
          }
          
          /**
           * Create {resource_name} | 创建
           * 
           * @param Request $request
           * @return Response
           */
          public function store(Request $request): Response
          {
              // TODO: 实现创建逻辑
              return $this->success([], 'Created successfully', 0, 201);
          }
          
          /**
           * Update {resource_name} | 更新
           * 
           * @param int $id
           * @param Request $request
           * @return Response
           */
          public function update(int $id, Request $request): Response
          {
              // TODO: 实现更新逻辑
              return $this->success([], 'Updated successfully');
          }
          
          /**
           * Delete {resource_name} | 删除
           * 
           * @param int $id
           * @return Response
           */
          public function destroy(int $id): Response
          {
              // TODO: 实现删除逻辑
              return $this->success([], 'Deleted successfully');
          }
      }
  
  - name: create_routes
    description: 创建路由定义
    actions:
      - 在 route/app.php 中添加路由
      - 应用中间件
      - 配置路由参数
    template: |
      // {ResourceName} API Routes | {ResourceName} API路由
      Route::group('{api_version}/{resource_name}', function () {
          Route::get('', '{ControllerName}@index');
          Route::get(':id', '{ControllerName}@show');
          Route::post('', '{ControllerName}@store');
          Route::put(':id', '{ControllerName}@update');
          Route::delete(':id', '{ControllerName}@destroy');
      })->middleware({middleware});

  - name: create_validator
    description: 创建验证器（可选）
    condition: with_validation == true
    actions:
      - 创建文件：app/validate/{ResourceName}Validate.php
      - 定义验证规则
      - 定义错误消息

  - name: create_tests
    description: 创建测试用例
    condition: with_tests == true
    actions:
      - 创建文件：tests/Feature/Api/{ResourceName}ApiTest.php
      - 测试所有 CRUD 操作
      - 测试权限控制
      - 测试数据验证

# 输出
outputs:
  - controller: app/controller/{ControllerName}.php
  - routes: route/app.php (已更新)
  - validator: app/validate/{ResourceName}Validate.php (可选)
  - tests: tests/Feature/Api/{ResourceName}ApiTest.php (可选)

# 使用示例
examples:
  - description: 创建商品 API
    command: |
      auggie --print "使用 create-api-endpoint skill 创建 products API，
      包含所有 CRUD 操作，需要认证和权限验证"

  - description: 创建简单的只读 API
    command: |
      auggie --print "使用 create-api-endpoint skill 创建 categories API，
      只包含 index 和 show 操作"

# 依赖
dependencies:
  - app\controller\ApiController
  - think\facade\Route

# 验证
validation:
  - 控制器必须继承 ApiController
  - 路由必须符合 RESTful 规范
  - 所有方法必须有 PHPDoc 注释
  - 必须使用统一的响应格式

