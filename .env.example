# Example environment configuration for AlkaidSYS-tp
# 请根据实际环境复制为 .env 并调整各项配置

# ============================================================
# Application Configuration | 应用配置
# ============================================================

# Application environment | 应用环境
# - local: 本地开发
# - dev/development: 开发环境
# - testing: 测试环境
# - staging: 预发布环境
# - production/prod: 生产环境
APP_ENV=local

# Debug mode | 调试模式
# - true: 开启调试（开发环境）
# - false: 关闭调试（生产环境必须为 false）
APP_DEBUG=true

# Default language | 默认语言
DEFAULT_LANG=zh-cn

# ============================================================
# Database Configuration | 数据库配置
# ============================================================

# Database type | 数据库类型
DB_TYPE=mysql

# Database driver | 数据库驱动
DB_DRIVER=mysql

# Database host | 数据库主机
DB_HOST=mysql

# Database port | 数据库端口
DB_PORT=3306

# Database name | 数据库名称
DB_NAME=alkaidsys

# Database user | 数据库用户名
DB_USER=root

# Database password | 数据库密码
DB_PASS=root

# Database charset | 数据库字符集
DB_CHARSET=utf8mb4

# Table prefix | 表前缀
DB_PREFIX=

# ============================================================
# JWT Configuration | JWT 配置
# ============================================================

# JWT issuer (iss) 配置
# 必须使用完整域名 / URL，建议按环境区分：
# - 开发：https://api.alkaidsys.local
# - 测试：https://api.test.alkaidsys.com
# - 生产：https://api.alkaidsys.com
JWT_ISSUER=https://api.alkaidsys.local
# JWT secret key 配置（T1-JWT-ENV）
# 开发环境可使用本地随机值；生产环境必须通过安全渠道配置为强随机密钥
JWT_SECRET=CHANGE_THIS_IN_PRODUCTION



# Cache & Redis configuration (T1-CACHE-REDIS)
# 缓存驱动：
# - 生产类环境（APP_ENV=production/prod/stage/staging）强制使用 redis
# - 非生产环境可选择 file 或 redis（默认 file）
CACHE_DRIVER=file

# Redis 连接配置
# - 本地 Docker 开发：推荐 REDIS_HOST=redis（与 docker-compose.yml 中 backend 的服务名保持一致）
# - 本地直连外部 Redis / 测试 / 生产：将 REDIS_HOST 改为外部 Redis 地址，例如：
#   - REDIS_HOST=your-redis.internal.example.com
#   - REDIS_PORT=6379
#   - REDIS_PASSWORD=your_strong_password（如启用密码）
#   - REDIS_DB=0
# 提示：
# - config/cache.php 会读取这些变量配置 `redis` 缓存 store；
# - config/session.php 会通过 cache+redis 复用同一连接；
# - 启动期 RedisHealthCheckService 会使用 Cache::store('redis') 做一次读写自检。
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# Database Deployment Configuration
# 数据库部署配置
#
# DB_DEPLOY: 部署方式
# - 0: 集中式（单一服务器，默认）
# - 1: 分布式（主从服务器）
DB_DEPLOY=0

# DB_RW_SEPARATE: 读写分离（仅在 DB_DEPLOY=1 时有效）
# - false: 不分离（默认）
# - true: 启用读写分离
DB_RW_SEPARATE=false

# DB_MASTER_NUM: 主服务器数量（仅在读写分离时有效）
DB_MASTER_NUM=1

# DB_SLAVE_NO: 指定从服务器序号（可选）
DB_SLAVE_NO=

# Runtime DDL guard for SchemaBuilder (T1-DDL-GUARD)
# 允许运行时 DDL 的环境白名单（逗号分隔，不区分大小写），默认：dev,local,testing
SCHEMA_RUNTIME_DDL_ALLOWED_ENVS=dev,local,testing
# 是否在允许的环境中放行运行时 DDL（默认 false，需显式开启）
ALLOW_RUNTIME_DDL=false

# CORS (Cross-Origin Resource Sharing) Configuration
# CORS 跨域资源共享配置
#
# 允许的源（Origin）列表，逗号分隔，用于控制哪些前端域名可以访问 API
# Allowed origins (comma-separated) to control which frontend domains can access the API
#
# 开发环境示例（允许所有本地开发服务器）：
# Development example (allow all local dev servers):
# CORS_ALLOWED_ORIGINS=http://localhost:5666,http://localhost:5173,http://localhost:5555,http://localhost:5556,http://localhost:5557
#
# 测试环境示例（允许测试域名）：
# Staging example (allow staging domains):
# CORS_ALLOWED_ORIGINS=https://app.test.alkaidsys.com,https://admin.test.alkaidsys.com
#
# 生产环境示例（仅允许生产域名）：
# Production example (only allow production domains):
# CORS_ALLOWED_ORIGINS=https://app.alkaidsys.com,https://admin.alkaidsys.com
#
# ⚠️ 安全提示 / Security Notes:
# 1. 生产环境必须明确配置允许的域名，禁止留空或使用通配符 *
#    Production MUST explicitly configure allowed domains, DO NOT leave empty or use wildcard *
# 2. 如果留空，开发环境会使用默认的 localhost 端口列表
#    If empty, development environment will use default localhost ports
# 3. 生产环境如果留空，CORS 中间件会记录警告日志
#    If empty in production, CORS middleware will log warnings
#
# 默认值（开发环境）/ Default (development):
CORS_ALLOWED_ORIGINS=

# Casbin 授权引擎配置
# Casbin Authorization Engine Configuration
#
# Casbin 是一个强大的访问控制库，支持 RBAC、ABAC、ACL 等多种模型。
# Casbin is a powerful access control library supporting RBAC, ABAC, ACL and more.
#
# @see https://casbin.org/
# @see https://github.com/php-casbin/php-casbin

# 是否启用 Casbin 授权引擎
# Whether to enable Casbin authorization engine
# - true: 启用 Casbin（Phase 2）
# - false: 使用数据库 RBAC（Phase 1，默认）
CASBIN_ENABLED=false

# Casbin 运行模式
# Casbin running mode
# - DB_ONLY: 仅使用数据库 RBAC（Phase 1，默认）
# - CASBIN_ONLY: 仅使用 Casbin（Phase 2 目标）
# - DUAL_MODE: 双模式运行，对比验证（过渡期）
CASBIN_MODE=DB_ONLY

# 是否启用 Casbin 日志
# Whether to enable Casbin logging
# - true: 启用日志（开发环境推荐）
# - false: 禁用日志（生产环境推荐，默认）
CASBIN_LOG_ENABLED=false

# 是否启用 Casbin 缓存
# Whether to enable Casbin cache
# - true: 启用缓存（生产环境推荐，默认）
# - false: 禁用缓存（开发环境可选）
CASBIN_CACHE_ENABLED=true

# Casbin 缓存过期时间（秒）
# Casbin cache TTL (seconds)
# 默认：3600（1 小时）
CASBIN_CACHE_TTL=3600

# Casbin 策略刷新间隔（秒）
# Casbin policy reload interval (seconds)
# 默认：300（5 分钟）
# 设置为 0 表示不自动刷新，需要手动调用刷新 API
CASBIN_RELOAD_TTL=300

# 是否启用 Casbin 策略缓存
# Whether to enable Casbin policy cache
# - true: 启用策略缓存（将完整策略缓存到 Redis，提升加载性能）
# - false: 禁用策略缓存（每次从数据库加载，默认）
CASBIN_POLICY_CACHE_ENABLED=false

# 是否启用 Casbin 缓存降级
# Whether to enable Casbin cache degradation
# - true: 启用降级（缓存不可用时降级到数据库）
# - false: 禁用降级（默认）
CASBIN_CACHE_DEGRADATION_ENABLED=false

# 是否启用 Casbin 缓存降级日志
# Whether to enable Casbin cache degradation logging
CASBIN_CACHE_DEGRADATION_LOG_ENABLED=false

# ============================================================
# Rate Limiting Configuration | 限流配置
# ============================================================

# 是否启用限流
# Whether to enable rate limiting
RATELIMIT_ENABLED=true

# 限流存储驱动
# Rate limit storage driver (redis, file)
RATELIMIT_STORE=redis

# 默认限流配置
# Default rate limit configuration
RATELIMIT_DEFAULT_LIMIT=100
RATELIMIT_DEFAULT_PERIOD=60

# IP 白名单（逗号分隔）
# IP whitelist (comma-separated)
RATELIMIT_WHITELIST_IPS=127.0.0.1

# IP 维度限流
# IP scope rate limiting
RATELIMIT_SCOPE_IP_ENABLED=true
RATELIMIT_SCOPE_IP_LIMIT=100
RATELIMIT_SCOPE_IP_PERIOD=60

# 用户维度限流
# User scope rate limiting
RATELIMIT_SCOPE_USER_ENABLED=true
RATELIMIT_SCOPE_USER_LIMIT=200
RATELIMIT_SCOPE_USER_PERIOD=60

# 租户维度限流
# Tenant scope rate limiting
RATELIMIT_SCOPE_TENANT_ENABLED=true
RATELIMIT_SCOPE_TENANT_LIMIT=1000
RATELIMIT_SCOPE_TENANT_PERIOD=60

# 路由维度限流
# Route scope rate limiting
RATELIMIT_SCOPE_ROUTE_ENABLED=true
RATELIMIT_SCOPE_ROUTE_LIMIT=50
RATELIMIT_SCOPE_ROUTE_PERIOD=60

# 登录接口限流（IP 维度）
# Login route rate limiting (IP scope)
RATELIMIT_ROUTE_LOGIN_IP_LIMIT=5
RATELIMIT_ROUTE_LOGIN_IP_PERIOD=60

# 登录接口限流（用户维度）
# Login route rate limiting (User scope)
RATELIMIT_ROUTE_LOGIN_USER_LIMIT=10
RATELIMIT_ROUTE_LOGIN_USER_PERIOD=300

# 低代码接口限流（租户维度）
# Lowcode route rate limiting (Tenant scope)
RATELIMIT_ROUTE_LOWCODE_TENANT_LIMIT=500
RATELIMIT_ROUTE_LOWCODE_TENANT_PERIOD=60
